<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  i18n:domain="collective.cover">

  <body tal:define="is_empty view/is_empty">
    <p tal:condition="python: is_empty and view.is_compose_mode()" i18n:translate="">
      Please drag&amp;drop a Sparql object here.
    </p>

    <div tal:condition="not: is_empty" class="cover-foldercontentslisting-tile tile-content">

      <style>

        .cards-wrapper {
          margin: 5em auto;
          max-width: 1000px;
          background-color: #fff;
          box-shadow: 0 0 5px 0 rgba(0, 0, 0, 0.06);
        }

        .cards {
          margin: 0 0 0 -1rem;
          /* padding: 15px; */
          display: flex;
          flex-flow: row wrap;
        }

        .card {
          min-height: 300px;
          width: calc((100% / 3) - 30px);
          transition: all 0.2s ease-in-out;
        }

        .card-desc-title {
          color: #ccc!important;
          font-weight: 400!important;
        }

        @media screen and (max-width: 991px) {
          .card {
            width: calc((100% / 2) - 30px);
          }
        }

        @media screen and (max-width: 767px) {
          .card {
            width: 100%;
          }
        }

        /*  .card:hover .card__inner { transform: scale(1.05); } */
        .card__inner {
          /* margin: 1rem; */
          border: 1px solid #eee;
          width: 100%;
          padding: .3em;
          position: relative;
          height: 290px;
          cursor: pointer;
          font-size: 1em;
          text-align: center;
          transition: all 0.2s ease-in-out;
        }

        .card__inner:after {
          transition: all 0.3s ease-in-out;
        }

        .card__expander {
          transition: all .7s;
          transition-property: opacity;
          background-color: #333a45;
          width: 100%;
          position: relative;
          display: flex;
          align-items: top;
          color: #eceef1;
          font-size: .8em;
          transform: translate3d(0,0,0);
        }

        .card-title {
          font-weight: 400;
        }

        .card__expander a {
          display: block;
          color: #eee!important;
          font-size: 1.7rem;
          margin: 2rem;
          flex: 1;
          min-height: 80.8%;
        }

        .card__expander .btn {
          color: black!important;
          max-width: 8rem;
          font-size: 1rem!important;
          min-height: 1%!important;
          padding: .8rem;
        }

        .card__expander img {
          padding: 2rem;
          width: 60%;
          display: inline-block;
          box-sizing: border-box;
        }

        .card__expander .iframe-wrapper {
          overflow: auto;
          padding: 2rem;
          max-width: 60%;
          display: inline-block;
          box-sizing: border-box;
        }

        .card-desc {
          box-sizing: border-box;
          max-width: 39%;
          display: inline-block;
        }

        .card__expander .fa {
          font-size: 1.75em;
          position: relative;
          padding: .5rem;
          cursor: pointer;
        }

        .card.is-collapsed .card__inner:after {
          content: "";
          opacity: 0;
        }

        .card.is-collapsed .card__expander {
          max-height: 0;
          min-height: 0;
          overflow: hidden;
          margin-top: 0;
          opacity: 0;
        }

        .card.is-expanded .card__inner:after {
          content: "";
          opacity: 1;
          display: block;
          height: 0;
          width: 0;
          position: absolute;
          bottom: -31px;
          left: calc(50% - 15px);
          border-left: 15px solid transparent;
          border-right: 15px solid transparent;
          border-bottom: 15px solid #333a45;
        }

        .card.is-expanded .card__inner .fa:before {
          content: "\f115";
        }

        .card.is-expanded .card__expander {
          z-index: 100;
          max-height: 1000px;
          min-height: 200px;
          overflow: visible;
          margin-top: 30px;
          opacity: 1;
        }

        /*    .card.is-expanded:hover .card__inner { transform: scale(1); }*/

        .card.is-inactive .card__inner {
          z-index: 1;
          pointer-events: none;
          opacity: 0.5;
        }

        .card.is-inactive {
          pointer-events: none;
        }

        h4 {
          font-weight: 400;
          font-size: 1.6rem;
          margin-top: 1rem;
        }
        .tile-header h4 { }
        #content .row:first {
          border: none;
        }
      </style>

      <div class="tile-header" tal:define="text python: view.data.get('text', '')">
        <h4 class="title" tal:content="python: view.data.get('title', 'Untitled')">Relevant singlerows</h4>
        <div class="text" tal:condition="text" tal:content="structure text/output">Text</div>
      </div>

      <div class="cards">
        <div tal:repeat="obj view/children" tal:omit-tag="">
          <div tal:replace="structure python: view.render_cell(obj)" />
          </div>
        </div>

        <script>
          /* <[CDATA[ */

  $(document).ready(function(){

    var $cell = $('.card');
    $cell.find('.js-expander').click(function() {

      var $thisCell = $(this).closest('.card');

      if ($thisCell.hasClass('is-collapsed')) {
        $cell.not($thisCell).removeClass('is-expanded').addClass('is-collapsed').addClass('is-inactive');
        $thisCell.removeClass('is-collapsed').addClass('is-expanded');

        var $ifw = $thisCell.find('.iframe-wrapper');

        var iurl = $ifw.data('iframe-url');
        var width = $ifw.data('iframe-width');
        var height = $ifw.data('iframe-height');
        $ifw.html("<iframe src='" + iurl + "' width=" + width + " height=" + height + " />");

        if ($cell.not($thisCell).hasClass('is-inactive')) {
          //do nothing
        } else {
          $cell.not($thisCell).addClass('is-inactive');
        }

      } else {
        $thisCell.removeClass('is-expanded').addClass('is-collapsed');
        $cell.not($thisCell).removeClass('is-inactive');
      }
    });

    $cell.find('.js-collapser').click(function() {
      var $thisCell = $(this).closest('.card');
      $thisCell.removeClass('is-expanded').addClass('is-collapsed');
      $cell.not($thisCell).removeClass('is-inactive');
    });

    $(".card").on('click', function(e){
      e.stopPropagation();
      var body=$('body')[0].getBoundingClientRect();
      var card=$(this)[0].getBoundingClientRect(),

        cardleft=card.left+($(this).outerWidth()-$(this).width())/2;
      bodywidth=body.width+($(this).outerWidth()-$(this).width())/2-14;

      $('.card__expander').css({
        'left' : -cardleft,
        'width': bodywidth
      });
      //console.log($(e.target).parent());
      if($(e.target).parent().hasClass('card__inner')){
        var bodytop = $('body').scrollTop();
        $('body').animate({ scrollTop: bodytop + 350 }, 300);
      }
    });

    $(".fa-close").on('click', function(){
      var bodytop = $('body').scrollTop();
      $('body').animate({ scrollTop: bodytop - 350 }, 300);
    });

    $('.expand').on('click', function(){
      $('.indicator-cards').toggleClass('flex-row-warp');
      $('#left-button, #right-button').toggleClass('buttons-hide')
    });

    var outer = $('.indicator-cards-wrapper');

    $('#left-button').click(function () {
      var leftPos = outer.scrollLeft();
      outer.animate({ scrollLeft: leftPos - 300 }, 300);
    });

    $('#right-button').click(function () {
      var leftPos = outer.scrollLeft();
      outer.animate({ scrollLeft: leftPos + 300 }, 300);
    });

  });
/* ]]> */
        </script>
      </div>
    </body>
  </html>
